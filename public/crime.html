<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Crime Spotter (beta) - PR.gov</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- JavaScript -->
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/jquery-ui.custom.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/bootstrap-select.min.js"></script>
    <script src="../assets/js/bootstrap-datepicker.js"></script>
    <script src="../assets/js/leaflet.js"></script>
    <script src="../assets/js/leaflet.markercluster.js"></script>

    <!-- CSS -->
    <link href="../assets/css/jquery-ui.custom.css" rel="stylesheet">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../assets/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="../assets/css/bootstrap-datepicker.css" rel="stylesheet">
    <link href="../assets/css/leaflet.css" rel="stylesheet">
    <!--[if lte IE 8]>
      <link href="../assets/css/leaflet.ie.css" rel="stylesheet" />
    <![endif]-->
    <link href="../assets/css/MarkerCluster.css" rel="stylesheet">
    <link href="../assets/css/MarkerCluster.Default.css" rel="stylesheet">
    <!--[if lte IE 8]><link href="../assets/css/MarkerCluster.Default.ie.css" rel="stylesheet" /><![endif]-->
    <link href="../assets/css/crime.css" rel="stylesheet">

    <style>
      body {
        padding-top: 52px; /* 60px to make the container go all the way to the bottom of the topbar */
      }

      .map-canvas,
      .map-canvas * { .box-sizing(content-box); }

      #map {
        height: 380px;
        /* width: 100%; */
        min-height: 100%;
        min-width: 100%;
        display: block;
      }
    </style>

    <script type="text/javascript">

      var map = null;
      var cluster_layer = null;
      
      function spotCrimes() {
        center = map.getCenter();
        distance = $("#distance-select").val();
        host = "compass.pr.gov"
        compass_request = "http://"+host+"/compass/delitos/location?lnglat="+map.getCenter().lng+","+map.getCenter().lat+"&dist="+distance
        if(cluster_layer != null) {
          map.removeLayer(cluster_layer);
        }
        $.getJSON(compass_request, function(data) {
          crimes_layer = L.geoJson(data, {
            pointToLayer: function (feature, latlng) {
              return L.marker(latlng, {icon: selectMarkerIcon(feature.properties.delito_id)});
            },
            onEachFeature: function (feature, layer) {
              var popupContent = "<p><strong>Delito:&nbsp;</strong>"+feature.properties.delito_desc+"<br><strong>Fecha:&nbsp;</strong>"+feature.properties.fecha_delito+"<br><strong>Hora:&nbsp;</strong>"+feature.properties.hora_delito+"</p>";
              layer.bindPopup(popupContent);
            }
          });

          cluster_layer = L.markerClusterGroup();
          cluster_layer.addLayer(crimes_layer);

          map.addLayer(cluster_layer);
        });
      }

      function selectMarkerIcon(id) {
        markerIcon = 'unknown.png';
        switch(id) {
          case 1:
            markerIcon = 'asesinato.png';
            break;
          case 2:
            markerIcon = 'violacion.png';
            break;
          case 3:
            markerIcon = 'robo.png';
            break;
          case 4:
            markerIcon = 'agresion.png';
            break;
          case 5:
            markerIcon = 'escalamiento.png';
            break;
          case 6:
            markerIcon = 'apropiacion-ilegal.png';
            break;
          case 7:
            markerIcon = 'vehiculo-hurtado.png';
            break;
          case 8:
            markerIcon = 'incendio.png';
            break;
        }
        return L.icon({
          iconUrl: '../assets/images/icons/' + markerIcon,
          iconSize: [32, 37],
          iconAnchor: [16, 37],
          popupAnchor: [0, -28]
        });
      }

      function locateGPS() {
        this.map.locate({setView : true});
        spotCrimes();
      }

      $(window).on('load', function () {
        $('#crimes-select').selectpicker('selectAll');
        $('#distance-select').selectpicker();
        $('#days-select').selectpicker();
        $('#days-select').selectpicker('val', '60');

        $('#range-datepicker').datepicker({
          autoclose: true,
          todayHighlight: true
        });
        $('.start').datepicker('setDate', new Date());

        var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            osmAttrib = '&copy; <a href="http://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            osm = L.tileLayer(osmUrl, {maxZoom: 18, attribution: osmAttrib});

        map = L.map('map').setView([18.428, -66.059], 14).addLayer(osm);
      });
    </script>
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Crime Spotter</a>
        <p class="navbar-text"><span class="label label-danger">beta</span></p>
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <button type="button" class="btn btn-info navbar-btn pull-right">About</button>
      </div>
    </nav>
    
    <div id="map" class="map-canvas"></div>
    
    <div class="container crime-search">
      <div class="row">
        <div class="col-md-9 col-sm-10 col-xs-10">
          <div class="panel-group" id="accordion">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseCrimes">
                    <strong>Crimes</strong>
                  </a>
                </h4>
              </div>
              <div id="collapseCrimes" class="panel-collapse collapse in">
                <div class="panel-body">  
                  <div class="col-md-8">
                    <span class="pull-left"><strong>Crimes:</strong></span>
                    <div class="row">
                      <div class="col-md-12">
                        <select id="crimes-select" class="selectpicker" title="" data-header="Select Crimes" data-width="100%" data-selected-text-format="count>3" data-container="body" multiple>
                          <!-- Apropiación ilegal es -->
                          <!-- Ver código Penal del 2012 para más información -->
                          <!-- http://www.ramajudicial.pr/leyes/codpenal2012.html -->
                          <!-- PDF: http://www.ramajudicial.pr/leyes/CODIGO-PENAL-2012-CLASIFICACION-DELITOS-PENAS-APLICABLES.pdf -->
                          <!-- Ver articulos del código penal -->
                          <option value=1>Asesinatos</option>
                          <option value=2>Violaci&oacute;n</option>
                          <!-- Articulo 189 -->
                          <!-- Robo es donde el sujeto arrebata la propiedad a la victima sin mayor fuerza -->          
                          <option value=3>Robos</option>
                          <option value=4>Agresi&oacute;n Agravada</option> 
                          <option value=5>Escalamientos</option>
                          <!-- Articulo 181 -->
                          <!-- toda persona que se apropie sin violencia de bienes muebes pertenecientes a otras personas -->
                          <option value=6>Apropiaci&oacute;n Ilegal</option>          
                          <option value=7>Vehiculos Hurtados</option>
                          <option value=8>Incendios</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <span class="pull-left"><strong>Distance:</strong></span>
                    <div class="row">
                      <div class="col-md-12">
                        <select id="distance-select" class="selectpicker show-tick" title="" data-header="Select Distance" data-width="100%" data-container="body">
                          <option value=1>1 mile</option>
                          <option value=3>3 miles</option>
                          <option value=5>5 miles </option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseDateTime">
                    <strong>Date</strong>
                  </a>
                </h4>
              </div>
              <div id="collapseDateTime" class="panel-collapse collapse">
                <div class="panel-body">
                  <div class="col-md-12">
                    <div class="col-md-6">
                      <div class="radio">
                        <label>
                          <input type="radio" name="date-radios" id="option-radio-days" value="days" checked>
                          <strong>Last</strong>
                        </label>
                        <select id="days-select" class="selectpicker show-tick" title="" data-header="Select Days" data-width="100%" data-container="body">
                          <option value=7>7 days</option>
                          <option value=30>30 days</option>
                          <option value=60>60 days</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="radio">
                        <label>
                          <input type="radio" name="date-radios" id="option-radio-range" value="range">
                          <strong>Range</strong>
                        </label>
                        <div class="input-daterange" id="range-datepicker">
                          <input type="text" class="form-control" name="start">
                          <input type="text" class="form-control" name="end">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-2 col-xs-2">
          <div class="row">
            <div class="crime-btns">
              <button type="button" class="btn btn-warning btn-lg btn-block" onclick=spotCrimes();>Display<br>Crimes</button>
            </div>
          </div>
          <div class="row">
            <div class="crime-btns gps-btn">
              <button type="button" class="btn btn-danger btn-lg btn-block visible-xs visible-sm" onclick=locateGPS();>GPS</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
